{% extends "base.html" %}
{% block title %}Edit Attendance{% endblock %}

{% block content %}

<div class="mb-4">
  <h3>Edit Attendance</h3>
  <p class="text-muted">
    Expand a date to edit attendance records.
  </p>
</div>

{% set current_date = None %}

<div class="accordion" id="attendanceAccordion">

{% for r in records %}
  {% if current_date != r[1] %}
    {% if not loop.first %}
        </tbody>
        </table>
        </div>
        </div>
      </div>
    {% endif %}

    {% set current_date = r[1] %}
    <div class="accordion-item mb-2">
      <h2 class="accordion-header">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#date{{ loop.index }}"
        >
          üìÖ {{ r[1] }}
        </button>
      </h2>

      <div
        id="date{{ loop.index }}"
        class="accordion-collapse collapse"
        data-bs-parent="#attendanceAccordion"
      >
        <div class="accordion-body p-0">

        <table class="table table-bordered align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Subject</th>
              <th>Hours</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
  {% endif %}

    <tr>
      <td>{{ r[2] }}</td>
      <td>{{ r[3] }}</td>
      <td>
        {% if r[4] %}
          <span class="badge bg-success">Present</span>
        {% else %}
          <span class="badge bg-danger">Absent</span>
        {% endif %}
      </td>
      <td>
        <form method="post" class="d-flex gap-2">
          <input type="hidden" name="att_id" value="{{ r[0] }}">
          <select name="status" class="form-select form-select-sm">
            <option value="1" {% if r[4] %}selected{% endif %}>Present</option>
            <option value="0" {% if not r[4] %}selected{% endif %}>Absent</option>
          </select>
          <button class="btn btn-sm btn-primary">
            Update
          </button>
        </form>
      </td>
    </tr>

  {% if loop.last %}
        </tbody>
        </table>
        </div>
      </div>
    </div>
  {% endif %}
{% endfor %}

</div>

<a href="/dashboard" class="btn btn-outline-secondary mt-3">
  ‚Üê Back to Dashboard
</a>

{% endblock %}

