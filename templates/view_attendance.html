{% extends "base.html" %}
{% block title %}Attendance Summary{% endblock %}

{% block content %}

<div class="mb-4">
  <h3>Attendance Summary</h3>
  <p class="text-muted">
    Overview of your attendance status.
  </p>
</div>

<!-- Overall attendance -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title">Overall Attendance</h5>

    <div class="row text-center mt-3">
      <div class="col-md-4">
        <h6>Total Hours</h6>
        <p class="fw-bold">{{ total_all }}</p>
      </div>
      <div class="col-md-4">
        <h6>Attended Hours</h6>
        <p class="fw-bold">{{ attended_all }}</p>
      </div>
      <div class="col-md-4">
        <h6>Percentage</h6>
        {% if overall_pct < 75 %}
          <p class="fw-bold text-danger">
            {{ "%.2f"|format(overall_pct) }}%
          </p>
        {% else %}
          <p class="fw-bold text-success">
            {{ "%.2f"|format(overall_pct) }}%
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Subject-wise attendance -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Subject-wise Attendance</h5>

    <div class="table-responsive">
      <table class="table table-bordered align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>Subject</th>
            <th>Total</th>
            <th>Attended</th>
            <th>Missed</th>
            <th>Progress</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for d in data %}
          {% set total = d[1] %}
          {% set attended = d[2] %}
          {% set missed = total - attended %}
          {% set pct = (attended / total * 100) if total > 0 else 0 %}
          <tr>
            <td class="text-start">{{ d[0] }}</td>
            <td>{{ total }}</td>
            <td>{{ attended }}</td>
            <td>{{ missed }}</td>
            <td style="min-width:140px">
              <div class="progress">
                <div
                  class="progress-bar {% if pct < 75 %}bg-danger{% else %}bg-success{% endif %}"
                  style="width: {{ pct }}%"
                >
                  {{ "%.0f"|format(pct) }}%
                </div>
              </div>
            </td>
            <td>
              {% if pct < 75 %}
                <span class="badge bg-danger">Shortage</span>
              {% else %}
                <span class="badge bg-success">Safe</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<a href="/dashboard" class="btn btn-outline-secondary">
  ‚Üê Back to Dashboard
</a>

{% endblock %}

